(()=>{"use strict";class t{constructor(){this.playlistData=null,this.theme=null}async loadPlaylist(){try{const t=this.detectLanguage(),e="ja"===t?'{\n  "playlist_info": {\n    "name": "サカ・カサンガ オーディオガイド",\n    "description": "サカ・カサンガ博物館展示のインタラクティブオーディオガイド",\n    "language": "ja",\n    "theme": {\n      "primary_color": "#ff6b6b",\n      "secondary_color": "#4ecdc4",\n      "accent_color": "#45b7d1",\n      "text_color": "#2c3e50",\n      "subtitle_color": "#7f8c8d",\n      "background_color": "#f8f9fa",\n      "progress_color": "#ff6b6b",\n      "gradient": "linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 100%)",\n      "header_background": "#ffffff",\n      "header_text_color": "#2c3e50",\n      "header_border_color": "#e0e0e0",\n      "footer_background": "#ffffff",\n      "footer_text_color": "#2c3e50",\n      "footer_border_color": "#e0e0e0",\n      "list_background": "#ffffff",\n      "list_item_hover": "#f8f9fa",\n      "list_item_active": "#e3f2fd",\n      "list_border_color": "#f0f0f0",\n      "button_hover_color": "#ff5252",\n      "shadow_color": "rgba(0,0,0,0.1)"\n    }\n  },\n  "tracks": [\n    {\n      "id": 1,\n      "playlist_name": "イントロダクション",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/KASANGA_0_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "サカ・カサンガ オーディオガイドへようこそ"\n    },\n    {\n      "id": 2,\n      "playlist_name": "ゾーン1：メラスティ - 浄化の潮流",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_1__Melasti_Tides_of_Purification_1_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "メラスティの浄化の儀式を探る"\n    },\n    {\n      "id": 3,\n      "playlist_name": "ゾーン1：ルマンパー・フニング - 静寂への旅",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_1__Artwork_11_Lumampah_Hning_Journey_into_Sil_2_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "瞑想の静寂への旅"\n    },\n    {\n      "id": 4,\n      "playlist_name": "ゾーン1：リラ・サゴトラ - 共に喜ぶ",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_1__Artwork_12_Lila_Sagotra_Rejoicing_Together_3_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "コミュニティと一体感を祝う"\n    },\n    {\n      "id": 5,\n      "playlist_name": "ゾーン1：チャンプハン・マサ - 時代の合流",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_1__Artwork_13_Campuhan_Masa_A_Confluence_of_E_4_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "異なる時代が出会い融合する場所"\n    },\n    {\n      "id": 6,\n      "playlist_name": "ゾーン1：ハングリプタ・ルム - 美の輝き",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_1__Artwork_14_Hangripta_Rum_Glow_of_Beauty_5_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "芸術的表現の輝く美しさ"\n    },\n    {\n      "id": 7,\n      "playlist_name": "ゾーン1：スカ・マゲング - 大いなる喜び",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_1__Artwork_15_Suka_Mageng_Great_Joy_6_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "祝祭の大いなる喜びを体験"\n    },\n    {\n      "id": 8,\n      "playlist_name": "ゾーン1：ガルギタ・マンゲニング - 静寂の響き",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_1__Artwork_16_Gargita_Mangening_Echoes_of_Sti_7_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "平和な静寂の響き"\n    },\n    {\n      "id": 9,\n      "playlist_name": "ゾーン2：タウル・カサンガ - バランスの回復",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_2__Tawur_Kasanga_Restoring_Balance_8_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "儀式を通じて宇宙のバランスを回復"\n    },\n    {\n      "id": 10,\n      "playlist_name": "ゾーン2：ムルワ・カラ - 昔に戻って",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_2_Artwork_21__Murwa_Kala_Back_in_the_Days_9_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "古代への旅"\n    },\n    {\n      "id": 11,\n      "playlist_name": "ゾーン2：サルワ・ルパ - 多くの形で",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_2_Artwork_22__Sarwa_Rupa_In_Many_Forms_10_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "多くの形で現れる神性"\n    },\n    {\n      "id": 12,\n      "playlist_name": "ゾーン2：カキ・パトゥク - 男性祖先",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_2_Artwork_221__Kaki_Patuk_Male_Ancestor_11_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "男性祖先の霊を敬う"\n    },\n    {\n      "id": 13,\n      "playlist_name": "ゾーン2：カラ・バング - 赤い巨人",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_2_Artwork_222__Kala_Bang_Red_Giant_12_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "強力な赤い巨人の守護者"\n    },\n    {\n      "id": 14,\n      "playlist_name": "ゾーン2：カラ・スンサン - 逆さまの巨人",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_2_Artwork_223__Kala_Sungsang_Inverted_Giant_13_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "逆さまの巨人の守護力"\n    },\n    {\n      "id": 15,\n      "playlist_name": "ゾーン2：ジャバン・カトゥカ - ビーマの息子",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_2_Artwork_224__Jabang_Katuka_Son_of_Bhima_14_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "力強いビーマの英雄的な息子"\n    },\n    {\n      "id": 16,\n      "playlist_name": "ゾーン2：ニワタカワチャ - 鬼王",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_2_Artwork_225__Niwatakawaca_The_Ogre-King_Niv_15_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "恐ろしい鬼王の物語"\n    },\n    {\n      "id": 17,\n      "playlist_name": "ゾーン2：マンダラ・マトラ - 宇宙のマンダラ",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_2_Artwork_23__Mandala_Matra_Cosmic_Mandala_16_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "宇宙のマンダラの神聖な幾何学"\n    },\n    {\n      "id": 18,\n      "playlist_name": "ゾーン2：リパンタラニング・ナンディ・カラ - 永遠の存在の中で",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_2_Artwork_24__Ripantaraning_Nandhi_Kala_Among_17_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "永遠の存在の中を移動"\n    },\n    {\n      "id": 19,\n      "playlist_name": "ゾーン2：エーテルの守護者",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_2_Artwork_241__Guardians_of_the_Ethereal_Bali_18_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "バリのエーテル守護者"\n    },\n    {\n      "id": 20,\n      "playlist_name": "ゾーン2：シータの誘拐",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_2_Artwork_242__The_Abduction_of_Sita_Sita_Kap_19_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "シータ誘拐の叙事詩"\n    },\n    {\n      "id": 21,\n      "playlist_name": "ゾーン2：強力な女英雄シカンディ",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_2_Artwork_243__The_Mighty_Heroine_Shikhandi_K_20_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "勇敢な女英雄シカンディの勇気"\n    },\n    {\n      "id": 22,\n      "playlist_name": "ゾーン2：女神サラスヴァティ",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_2_Artwork_244__Goddess_Sarasvati_Dewi_Saraswa_21_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "知識と知恵の女神"\n    },\n    {\n      "id": 23,\n      "playlist_name": "ゾーン2：マヒシャースラの最期",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_2_Artwork_245__The_End_of_Mahishasura_Mahesas_22_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "悪魔マヒシャースラの敗北"\n    },\n    {\n      "id": 24,\n      "playlist_name": "ゾーン2：猿に包囲されたクンバカルナ",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_2_Artwork_246__Kumbhakarna_Besieged_by_the_Mo_23_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "巨人クンバカルナの戦い"\n    },\n    {\n      "id": 25,\n      "playlist_name": "ゾーン2：ラーヴァナとヴィマーナの怒り",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_2_Artwork_247__The_Fury_of_Ravana_and_Vimana__24_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "ラーヴァナの怒りと飛行戦車"\n    },\n    {\n      "id": 26,\n      "playlist_name": "ゾーン2：狡猾な鶴の欺瞞",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_2_Artwork_248__The_Cunning_Cranes_Deception_P_25_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "賢い鶴の欺瞞計画"\n    },\n    {\n      "id": 27,\n      "playlist_name": "ゾーン2：ヒランヤカシプの終焉",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_2_Artwork_249__The_Demise_of_Hiranyakashipu_H_26_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "悪魔王の没落"\n    },\n    {\n      "id": 28,\n      "playlist_name": "ゾーン2：神の子の挑戦",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_2_Artwork_2410__Child_of_The_Divine_Challenge_27_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "神の子の偉大な挑戦"\n    },\n    {\n      "id": 29,\n      "playlist_name": "ゾーン3：ニュピ - 静かな敬意",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_3_-_Nyepi_Quiet_Reverence_28_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "ニュピの神聖な静寂"\n    },\n    {\n      "id": 30,\n      "playlist_name": "ゾーン3：チェトラ・マサ - 第九の月",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_3_Artwork_31_-_Cetra_Masa_The_Ninth_Month_29_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "第九の月の意義"\n    },\n    {\n      "id": 31,\n      "playlist_name": "ゾーン3：チャンドラ・サンカラ",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_3_Artwork_311_-_Chandra_Sangkala_30_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "月の神聖な年代学"\n    },\n    {\n      "id": 32,\n      "playlist_name": "ゾーン3：作品312",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_3_Artwork_312_31_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "神聖な作品の探求"\n    },\n    {\n      "id": 33,\n      "playlist_name": "ゾーン3：作品313",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_3_Artwork_313_32_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "芸術における精神的象徴"\n    },\n    {\n      "id": 34,\n      "playlist_name": "ゾーン3：作品314-1",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_3_Artwork_314-1_33_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "神聖な作品シリーズの第一部"\n    },\n    {\n      "id": 35,\n      "playlist_name": "ゾーン3：作品314-2",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_3_Artwork_314-2_34_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "神聖な作品シリーズの第二部"\n    },\n    {\n      "id": 36,\n      "playlist_name": "ゾーン3：作品315",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_3_Artwork_315_35_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "芸術の旅の継続"\n    },\n    {\n      "id": 37,\n      "playlist_name": "ゾーン3：作品316",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_3_Artwork_316_36_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "神聖なコレクションの深層"\n    },\n    {\n      "id": 38,\n      "playlist_name": "ゾーン3：作品317",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_3_Artwork_317_37_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "芸術的形式の古代の知恵"\n    },\n    {\n      "id": 39,\n      "playlist_name": "ゾーン3：作品318",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_3_Artwork_318_38_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "石に刻まれた神聖な物語"\n    },\n    {\n      "id": 40,\n      "playlist_name": "ゾーン3：作品319",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_3_Artwork_319_39_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "時に刻まれた神の物語"\n    },\n    {\n      "id": 41,\n      "playlist_name": "ゾーン3：作品3110",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_3_Artwork_3110_40_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "ゾーン3の最終作品"\n    },\n    {\n      "id": 42,\n      "playlist_name": "ゾーン4：ゲンバク・ゲニ - 再生を抱く",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_4_-_Ngembak_Geni_Embracing_Renewal_41_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "生命の再生を抱く"\n    },\n    {\n      "id": 43,\n      "playlist_name": "ゾーン4：ダムー・アクサラ",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/ja/Zone_4_Artwork_41_-_Damuh_Aksara_42_ja_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "神聖な文字とその意味"\n    }\n  ]\n}':'{\n  "playlist_info": {\n    "name": "Saka Kasanga Audio Guide",\n    "description": "Interactive audio guide for Saka Kasanga museum exhibit",\n    "language": "en",\n    "theme": {\n      "primary_color": "#ff6b6b",\n      "secondary_color": "#4ecdc4",\n      "accent_color": "#45b7d1",\n      "text_color": "#2c3e50",\n      "subtitle_color": "#7f8c8d",\n      "background_color": "#f8f9fa",\n      "progress_color": "#ff6b6b",\n      "gradient": "linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 100%)",\n      "header_background": "#ffffff",\n      "header_text_color": "#2c3e50",\n      "header_border_color": "#e0e0e0",\n      "footer_background": "#ffffff",\n      "footer_text_color": "#2c3e50",\n      "footer_border_color": "#e0e0e0",\n      "list_background": "#ffffff",\n      "list_item_hover": "#f8f9fa",\n      "list_item_active": "#e3f2fd",\n      "list_border_color": "#f0f0f0",\n      "button_hover_color": "#ff5252",\n      "shadow_color": "rgba(0,0,0,0.1)"\n    }\n  },\n  "tracks": [\n    {\n      "id": 1,\n      "playlist_name": "Introduction",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/KASANGA_0_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "Welcome to the Saka Kasanga audio guide"\n    },\n    {\n      "id": 2,\n      "playlist_name": "Zone 1: Melasti - Tides of Purification",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_1__Melasti_Tides_of_Purification_1_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "Explore the purification rituals of Melasti"\n    },\n    {\n      "id": 3,\n      "playlist_name": "Zone 1: Lumampah Hning - Journey into Silence",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_1__Artwork_11_Lumampah_Hning_Journey_into_Sil_2_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "Journey into the silence of meditation"\n    },\n    {\n      "id": 4,\n      "playlist_name": "Zone 1: Lila Sagotra - Rejoicing Together",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_1__Artwork_12_Lila_Sagotra_Rejoicing_Together_3_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "Celebrating community and togetherness"\n    },\n    {\n      "id": 5,\n      "playlist_name": "Zone 1: Campuhan Masa - A Confluence of Eras",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_1__Artwork_13_Campuhan_Masa_A_Confluence_of_E_4_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "Where different eras meet and blend"\n    },\n    {\n      "id": 6,\n      "playlist_name": "Zone 1: Hangripta Rum - Glow of Beauty",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_1__Artwork_14_Hangripta_Rum_Glow_of_Beauty_5_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The radiant beauty of artistic expression"\n    },\n    {\n      "id": 7,\n      "playlist_name": "Zone 1: Suka Mageng - Great Joy",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_1__Artwork_15_Suka_Mageng_Great_Joy_6_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "Experiencing the great joy of celebration"\n    },\n    {\n      "id": 8,\n      "playlist_name": "Zone 1: Gargita Mangening - Echoes of Stillness",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_1__Artwork_16_Gargita_Mangening_Echoes_of_Sti_7_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The echoes of peaceful stillness"\n    },\n    {\n      "id": 9,\n      "playlist_name": "Zone 2: Tawur Kasanga - Restoring Balance",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_2__Tawur_Kasanga_Restoring_Balance_8_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "Restoring cosmic balance through ritual"\n    },\n    {\n      "id": 10,\n      "playlist_name": "Zone 2: Murwa Kala - Back in the Days",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_2_Artwork_21__Murwa_Kala_Back_in_the_Days_9_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "Journeying back to ancient times"\n    },\n    {\n      "id": 11,\n      "playlist_name": "Zone 2: Sarwa Rupa - In Many Forms",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_2_Artwork_22__Sarwa_Rupa_In_Many_Forms_10_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The divine manifested in many forms"\n    },\n    {\n      "id": 12,\n      "playlist_name": "Zone 2: Kaki Patuk - Male Ancestor",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_2_Artwork_221__Kaki_Patuk_Male_Ancestor_11_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "Honoring the male ancestral spirits"\n    },\n    {\n      "id": 13,\n      "playlist_name": "Zone 2: Kala Bang - Red Giant",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_2_Artwork_222__Kala_Bang_Red_Giant_12_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The powerful red giant guardian"\n    },\n    {\n      "id": 14,\n      "playlist_name": "Zone 2: Kala Sungsang - Inverted Giant",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_2_Artwork_223__Kala_Sungsang_Inverted_Giant_13_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The inverted giant\'s protective power"\n    },\n    {\n      "id": 15,\n      "playlist_name": "Zone 2: Jabang Katuka - Son of Bhima",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_2_Artwork_224__Jabang_Katuka_Son_of_Bhima_14_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The heroic son of the mighty Bhima"\n    },\n    {\n      "id": 16,\n      "playlist_name": "Zone 2: Niwatakawaca - The Ogre-King",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_2_Artwork_225__Niwatakawaca_The_Ogre-King_Niv_15_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The fearsome ogre-king\'s story"\n    },\n    {\n      "id": 17,\n      "playlist_name": "Zone 2: Mandala Matra - Cosmic Mandala",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_2_Artwork_23__Mandala_Matra_Cosmic_Mandala_16_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The cosmic mandala\'s sacred geometry"\n    },\n    {\n      "id": 18,\n      "playlist_name": "Zone 2: Ripantaraning Nandhi Kala - Among the Eternals",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_2_Artwork_24__Ripantaraning_Nandhi_Kala_Among_17_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "Moving among the eternal beings"\n    },\n    {\n      "id": 19,\n      "playlist_name": "Zone 2: Guardians of the Ethereal",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_2_Artwork_241__Guardians_of_the_Ethereal_Bali_18_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The ethereal guardians of Bali"\n    },\n    {\n      "id": 20,\n      "playlist_name": "Zone 2: The Abduction of Sita",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_2_Artwork_242__The_Abduction_of_Sita_Sita_Kap_19_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The epic tale of Sita\'s abduction"\n    },\n    {\n      "id": 21,\n      "playlist_name": "Zone 2: The Mighty Heroine Shikhandi",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_2_Artwork_243__The_Mighty_Heroine_Shikhandi_K_20_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The brave heroine Shikhandi\'s courage"\n    },\n    {\n      "id": 22,\n      "playlist_name": "Zone 2: Goddess Saraswati",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_2_Artwork_244__Goddess_Sarasvati_Dewi_Saraswa_21_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The goddess of knowledge and wisdom"\n    },\n    {\n      "id": 23,\n      "playlist_name": "Zone 2: The End of Mahishasura",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_2_Artwork_245__The_End_of_Mahishasura_Mahesas_22_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The defeat of the demon Mahishasura"\n    },\n    {\n      "id": 24,\n      "playlist_name": "Zone 2: Kumbhakarna Besieged by the Monkeys",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_2_Artwork_246__Kumbhakarna_Besieged_by_the_Mo_23_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The giant Kumbhakarna\'s battle"\n    },\n    {\n      "id": 25,\n      "playlist_name": "Zone 2: The Fury of Ravana and Vimana",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_2_Artwork_247__The_Fury_of_Ravana_and_Vimana__24_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "Ravana\'s rage and his flying chariot"\n    },\n    {\n      "id": 26,\n      "playlist_name": "Zone 2: The Cunning Crane\'s Deception",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_2_Artwork_248__The_Cunning_Cranes_Deception_P_25_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The clever crane\'s deceptive plan"\n    },\n    {\n      "id": 27,\n      "playlist_name": "Zone 2: The Demise of Hiranyakashipu",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_2_Artwork_249__The_Demise_of_Hiranyakashipu_H_26_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The downfall of the demon king"\n    },\n    {\n      "id": 28,\n      "playlist_name": "Zone 2: Child of The Divine Challenge",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_2_Artwork_2410__Child_of_The_Divine_Challenge_27_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The divine child\'s great challenge"\n    },\n    {\n      "id": 29,\n      "playlist_name": "Zone 3: Nyepi - Quiet Reverence",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_3_-_Nyepi_Quiet_Reverence_28_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The sacred silence of Nyepi"\n    },\n    {\n      "id": 30,\n      "playlist_name": "Zone 3: Cetra Masa - The Ninth Month",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_3_Artwork_31_-_Cetra_Masa_The_Ninth_Month_29_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The significance of the ninth month"\n    },\n    {\n      "id": 31,\n      "playlist_name": "Zone 3: Chandra Sangkala",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_3_Artwork_311_-_Chandra_Sangkala_30_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The moon\'s sacred chronology"\n    },\n    {\n      "id": 32,\n      "playlist_name": "Zone 3: Artwork 312",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_3_Artwork_312_31_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "Exploring the sacred artwork"\n    },\n    {\n      "id": 33,\n      "playlist_name": "Zone 3: Artwork 313",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_3_Artwork_313_32_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "Spiritual symbolism in art"\n    },\n    {\n      "id": 34,\n      "playlist_name": "Zone 3: Artwork 314-1",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_3_Artwork_314-1_33_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "First part of sacred artwork series"\n    },\n    {\n      "id": 35,\n      "playlist_name": "Zone 3: Artwork 314-2",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_3_Artwork_314-2_34_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "Second part of sacred artwork series"\n    },\n    {\n      "id": 36,\n      "playlist_name": "Zone 3: Artwork 315",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_3_Artwork_315_35_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "Continuing the artistic journey"\n    },\n    {\n      "id": 37,\n      "playlist_name": "Zone 3: Artwork 316",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_3_Artwork_316_36_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "Deeper into the sacred collection"\n    },\n    {\n      "id": 38,\n      "playlist_name": "Zone 3: Artwork 317",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_3_Artwork_317_37_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "Ancient wisdom in artistic form"\n    },\n    {\n      "id": 39,\n      "playlist_name": "Zone 3: Artwork 318",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_3_Artwork_318_38_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "Sacred narratives in stone"\n    },\n    {\n      "id": 40,\n      "playlist_name": "Zone 3: Artwork 319",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_3_Artwork_319_39_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "Divine stories carved in time"\n    },\n    {\n      "id": 41,\n      "playlist_name": "Zone 3: Artwork 3110",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_3_Artwork_3110_40_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The final artwork of Zone 3"\n    },\n    {\n      "id": 42,\n      "playlist_name": "Zone 4: Ngembak Geni - Embracing Renewal",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_4_-_Ngembak_Geni_Embracing_Renewal_41_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "Embracing the renewal of life"\n    },\n    {\n      "id": 43,\n      "playlist_name": "Zone 4: Damuh Aksara",\n      "song_url": "https://raw.githubusercontent.com/eresytter/saka-kasanga/main/tts_lossless/en/Zone_4_Artwork_41_-_Damuh_Aksara_42_en_optimized.mp3",\n      "thumbnail_url": "",\n      "description": "The sacred letters and their meaning"\n    }\n  ]\n}';return this.playlistData=e,this.theme=this.playlistData.playlist_info.theme,this.processTrackThumbnails(),console.log("Playlist loaded successfully:",this.playlistData.playlist_info.name,"Language:",t),this.playlistData}catch(t){return console.error("Error loading playlist:",t),this.getFallbackPlaylist()}}detectLanguage(){const t=window.location.pathname;return t.includes("-ja")||t.includes("/ja/")?"ja":"en"}processTrackThumbnails(){this.playlistData&&this.playlistData.tracks&&this.playlistData.tracks.forEach(t=>{t.thumbnail_url&&""!==t.thumbnail_url.trim()||(t.thumbnail_initials=this.generateInitials(t.playlist_name))})}generateInitials(t){if(!t)return"MG";const e=t.trim().split(/\s+/);return 1===e.length?e[0].substring(0,2).toUpperCase():e.slice(0,2).map(t=>t.charAt(0)).join("").toUpperCase()}getTracks(){return this.playlistData?.tracks||[]}getPlaylistInfo(){return this.playlistData?.playlist_info||null}getTheme(){return this.theme}applyTheme(){if(!this.theme)return void console.warn("No theme data available to apply");console.log("Applying theme:",this.theme);const t=t=>!!t&&(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(t)||t.startsWith("rgb")||t.startsWith("rgba")||t.startsWith("hsl")||t.startsWith("linear-gradient")||t.startsWith("radial-gradient")),e=document.documentElement;t(this.theme.primary_color)?e.style.setProperty("--primary-color",this.theme.primary_color):console.warn("Invalid primary_color:",this.theme.primary_color),t(this.theme.secondary_color)&&e.style.setProperty("--secondary-color",this.theme.secondary_color),t(this.theme.background_color)?(e.style.setProperty("--background-color",this.theme.background_color),document.body.style.backgroundColor=this.theme.background_color,console.log("Setting body background to:",this.theme.background_color)):console.warn("Invalid background_color:",this.theme.background_color),t(this.theme.accent_color)&&e.style.setProperty("--accent-color",this.theme.accent_color),t(this.theme.text_color)&&e.style.setProperty("--text-color",this.theme.text_color),t(this.theme.subtitle_color)&&e.style.setProperty("--subtitle-color",this.theme.subtitle_color),t(this.theme.progress_color)&&e.style.setProperty("--progress-color",this.theme.progress_color),this.theme.gradient&&e.style.setProperty("--gradient",this.theme.gradient),t(this.theme.header_background)&&e.style.setProperty("--header-background",this.theme.header_background),t(this.theme.header_text_color)&&e.style.setProperty("--header-text-color",this.theme.header_text_color),t(this.theme.header_border_color)&&e.style.setProperty("--header-border-color",this.theme.header_border_color),t(this.theme.footer_background)&&e.style.setProperty("--footer-background",this.theme.footer_background),t(this.theme.footer_text_color)&&e.style.setProperty("--footer-text-color",this.theme.footer_text_color),t(this.theme.footer_border_color)&&e.style.setProperty("--footer-border-color",this.theme.footer_border_color),t(this.theme.list_background)&&e.style.setProperty("--list-background",this.theme.list_background),t(this.theme.list_item_hover)&&e.style.setProperty("--list-item-hover",this.theme.list_item_hover),t(this.theme.list_item_active)&&e.style.setProperty("--list-item-active",this.theme.list_item_active),t(this.theme.list_border_color)&&e.style.setProperty("--list-border-color",this.theme.list_border_color),t(this.theme.button_hover_color)&&e.style.setProperty("--button-hover-color",this.theme.button_hover_color),this.theme.shadow_color&&e.style.setProperty("--shadow-color",this.theme.shadow_color),document.body.style.color=this.theme.text_color,setTimeout(()=>{document.body.style.display="none",document.body.offsetHeight,document.body.style.display="",console.log("Applied CSS variables:"),console.log("--primary-color:",getComputedStyle(e).getPropertyValue("--primary-color")),console.log("--secondary-color:",getComputedStyle(e).getPropertyValue("--secondary-color")),console.log("--background-color:",getComputedStyle(e).getPropertyValue("--background-color")),console.log("--header-background:",getComputedStyle(e).getPropertyValue("--header-background")),console.log("--footer-background:",getComputedStyle(e).getPropertyValue("--footer-background")),console.log("--list-background:",getComputedStyle(e).getPropertyValue("--list-background")),console.log("Body background:",getComputedStyle(document.body).backgroundColor),console.log("Body style background:",document.body.style.backgroundColor)},100),console.log("Theme applied successfully")}getFallbackPlaylist(){return{playlist_info:{name:"Museum Audio Guide",description:"Default audio guide",theme:{primary_color:"#667eea",secondary_color:"#764ba2",accent_color:"#f093fb",text_color:"#333",subtitle_color:"#666",background_color:"#f5f5f5",progress_color:"#667eea",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}},tracks:[{id:1,playlist_name:"Museum Guide",song_url:"https://commondatastorage.googleapis.com/codeskulptor-demos/DDR_assets/Sevish_-__nbsp_.mp3",thumbnail_url:"",thumbnail_initials:"MG",description:"Default museum audio guide track"}]}}getTrackById(t){return this.getTracks().find(e=>e.id===t)||null}getTrackCount(){return this.getTracks().length}}const e={formatTime:t=>isNaN(t)?"0:00":`${Math.floor(t/60)}:${Math.floor(t%60).toString().padStart(2,"0")}`,createElement(t,e,n){const a=document.createElement(t);return e&&(a.className=e),n&&(a.innerHTML=n),a}},n=class{constructor(){this.tracks=[],this.currentTrack=1,this.isPlaying=!1,this.isMuted=!1,this.completedTracks=new Set,this.currentTime=0,this.playlistManager=new t,this.initializeTracks(),this.loadSavedState()}async initializeTracks(){try{const t=await this.playlistManager.loadPlaylist();this.tracks=t.tracks.map(t=>{const e={id:t.id,title:t.playlist_name,description:t.description,url:t.song_url,duration:0,icon:t.thumbnail_url?t.thumbnail_url:t.thumbnail_initials,thumbnail_url:t.thumbnail_url,thumbnail_initials:t.thumbnail_initials};return console.log("Processed track:",e.title,"thumbnail_url:",e.thumbnail_url),e}),console.log(`Loaded ${this.tracks.length} tracks from playlist`)}catch(t){console.error("Failed to load playlist, using fallback:",t),this.initializeFallbackTracks()}}initializeFallbackTracks(){const t=["https://commondatastorage.googleapis.com/codeskulptor-demos/DDR_assets/Sevish_-__nbsp_.mp3","https://commondatastorage.googleapis.com/codeskulptor-assets/week7-brrring.m4a","https://commondatastorage.googleapis.com/codeskulptor-assets/Epoq-Lepidoptera.ogg"];for(let e=1;e<=10;e++)this.tracks.push({id:e,title:`Part ${e} - Museum Display`,description:`Museum Audio Guide - Display ${e}`,url:t[e%t.length],duration:0,icon:e.toString()})}getCurrentTrack(){return this.tracks[this.currentTrack-1]}setCurrentTrack(t){this.currentTrack=t,this.saveState()}markTrackCompleted(t){this.completedTracks.add(t),this.saveState()}isTrackCompleted(t){return this.completedTracks.has(t)}clearSavedState(){localStorage.removeItem("museumAudioGuideTrack"),localStorage.removeItem("museumAudioGuideCompleted"),localStorage.removeItem("museumAudioGuideDurations"),this.completedTracks.clear(),console.log("Cleared all saved state")}setPlaying(t){this.isPlaying=t}setCurrentTime(t){this.currentTime=t}setDuration(t,e){const n=this.tracks.find(e=>e.id===t);n&&(n.duration=e,this.saveState())}setMuted(t){this.isMuted=t}saveState(){localStorage.setItem("museumAudioGuideTrack",this.currentTrack),localStorage.setItem("museumAudioGuideCompleted",JSON.stringify([...this.completedTracks]));const t={};this.tracks.forEach(e=>{e.duration>0&&(t[e.id]=e.duration)}),localStorage.setItem("museumAudioGuideDurations",JSON.stringify(t))}loadSavedState(){const t=localStorage.getItem("museumAudioGuideTrack");t&&t>=1&&t<=43&&(this.currentTrack=parseInt(t));const e=localStorage.getItem("museumAudioGuideCompleted");if(e)try{const t=JSON.parse(e);this.completedTracks=new Set(t),console.log("Loaded completed tracks from localStorage:",[...this.completedTracks])}catch(t){console.warn("Failed to load completed tracks:",t),this.completedTracks=new Set}const n=localStorage.getItem("museumAudioGuideDurations");if(n)try{const t=JSON.parse(n);this.tracks.forEach(e=>{t[e.id]&&(e.duration=t[e.id])}),console.log("Loaded track durations from localStorage")}catch(t){console.warn("Failed to load track durations:",t)}}};class a{constructor(t,e){this.audioState=t,this.onProgressClick=e,this.element=null,this.progressFill=null,this.currentTime=null,this.totalTime=null,this.create()}create(){this.element=e.createElement("div","header");const t=this.audioState.getCurrentTrack()||{title:"Loading...",description:"Please wait...",icon:"MG",thumbnail_url:"",thumbnail_initials:"MG"};this.element.innerHTML=`\n            <div class="current-track-header">\n                <div class="track-info">\n                    <div class="current-track-image" id="currentTrackImage">\n                        ${this.renderTrackImage(t)}\n                    </div>\n                    <div class="track-details">\n                        <div class="current-track-title" id="currentTrackTitle">${t.title}</div>\n                        <div class="current-track-subtitle" id="currentTrackSubtitle">${t.description}</div>\n                    </div>\n                    <div class="language-selector">\n                        <select id="languageSelect" class="language-dropdown">\n                            <option value="en" ${"en"===this.getCurrentLanguage()?"selected":""}>EN</option>\n                            <option value="ja" ${"ja"===this.getCurrentLanguage()?"selected":""}>JA</option>\n                        </select>\n                    </div>\n                </div>\n                \n                <div class="header-progress">\n                    <div class="progress-bar" id="progressBar">\n                        <div class="progress-fill" id="progressFill"></div>\n                    </div>\n                    <div class="time-info">\n                        <span id="currentTime">00:00</span>\n                        <span id="totalTime">00:00</span>\n                    </div>\n                </div>\n            </div>\n        `,this.progressFill=this.element.querySelector("#progressFill"),this.currentTime=this.element.querySelector("#currentTime"),this.totalTime=this.element.querySelector("#totalTime");const n=this.element.querySelector("#currentTrackImage");this.setupImageLoadHandlers(n);const a=this.element.querySelector("#progressBar");a&&a.addEventListener("click",this.handleProgressClick.bind(this));const s=this.element.querySelector("#languageSelect");s&&s.addEventListener("change",this.handleLanguageChange.bind(this))}handleProgressClick(t){if(this.onProgressClick){const e=t.currentTarget.getBoundingClientRect(),n=(t.clientX-e.left)/e.width;this.onProgressClick(n)}}getCurrentLanguage(){const t=window.location.pathname;return t.includes("-ja")||t.includes("/ja/")?"ja":"en"}handleLanguageChange(t){const e=t.target.value;if(e!==this.getCurrentLanguage()){let t;window.location.pathname,window.location.origin,window.location.pathname.replace(/\/[^\/]*$/,""),t="ja"===e?"https://www.sakamuseum.org/audioguide/audio-guide-kasanga-ja":"https://www.sakamuseum.org/audioguide/audio-guide-kasanga",window.location.href=t}}renderTrackImage(t){return console.log("Rendering track image for:",t.title,"thumbnail_url:",t.thumbnail_url),t.thumbnail_url&&""!==t.thumbnail_url.trim()?`<img class="track-image" src="${t.thumbnail_url}" alt="${t.title}" style="display: none;" />\n                    <div class="fallback-text">${t.thumbnail_initials||t.icon||"MG"}</div>`:`<div class="fallback-text">${t.thumbnail_initials||t.icon||"MG"}</div>`}setupImageLoadHandlers(t){const e=t.querySelector(".track-image"),n=t.querySelector(".fallback-text");e&&n&&(e.onload=()=>{e.style.display="block",n.style.display="none"},e.onerror=()=>{e.style.display="none",n.style.display="flex"},e.complete&&(e.naturalWidth>0?e.onload():e.onerror()))}updateTrack(){const t=this.audioState.getCurrentTrack();if(!t)return;const e=this.element.querySelector("#currentTrackImage");e.innerHTML=this.renderTrackImage(t),this.setupImageLoadHandlers(e),this.element.querySelector("#currentTrackTitle").textContent=t.title,this.element.querySelector("#currentTrackSubtitle").textContent=t.description}updateProgress(t,n){if(n&&n>0){const a=t/n*100;this.progressFill.style.width=a+"%",this.currentTime.textContent=e.formatTime(t),this.totalTime.textContent=e.formatTime(n)}else this.progressFill.style.width="0%",this.currentTime.textContent="00:00",this.totalTime.textContent="00:00"}update(){this.updateTrack()}render(t){t.appendChild(this.element)}}class s{constructor(t,e){this.audioState=t,this.onTrackSelect=e,this.element=null,this.create()}create(){this.element=e.createElement("div","list-container"),this.element.innerHTML='<div class="audio-list" id="audioList"></div>',this.listElement=this.element.querySelector("#audioList"),this.renderTracks()}renderTracks(){this.listElement.innerHTML="",this.audioState.tracks.forEach(t=>{const e=this.createTrackItem(t);this.listElement.appendChild(e)})}createTrackItem(t){const n=e.createElement("div","audio-item");t.id===this.audioState.currentTrack&&n.classList.add("active"),this.audioState.isTrackCompleted(t.id)&&n.classList.add("completed");const a=t.id===this.audioState.currentTrack&&this.audioState.isPlaying?'<div class="playing-indicator playing">♪</div>':"",s=this.audioState.isTrackCompleted(t.id)?'<span class="completion-badge">✓</span>':"";n.innerHTML=`\n            <div class="audio-thumbnail" data-track-id="${t.id}">\n                ${this.renderTrackThumbnail(t)}\n            </div>\n            <div class="audio-info">\n                <div class="audio-title">${t.title}</div>\n                <div class="audio-subtitle">${t.description}</div>\n            </div>\n            <div class="audio-duration">\n                ${a}\n                ${e.formatTime(t.duration)}\n                ${s}\n            </div>\n        `,n.onclick=()=>this.handleTrackSelect(t.id);const i=n.querySelector(".audio-thumbnail");return this.setupThumbnailHandlers(i),n}renderTrackThumbnail(t){return t.thumbnail_url&&""!==t.thumbnail_url.trim()?`<img class="track-thumbnail-image" src="${t.thumbnail_url}" alt="${t.title}" style="display: none;" />\n                    <div class="thumbnail-fallback">${t.thumbnail_initials||t.icon||"MG"}</div>`:`<div class="thumbnail-fallback">${t.thumbnail_initials||t.icon||"MG"}</div>`}setupThumbnailHandlers(t){const e=t.querySelector(".track-thumbnail-image"),n=t.querySelector(".thumbnail-fallback");e&&n&&(e.onload=()=>{e.style.display="block",n.style.display="none"},e.onerror=()=>{e.style.display="none",n.style.display="flex"},e.complete&&(e.naturalWidth>0?e.onload():e.onerror()))}handleTrackSelect(t){this.onTrackSelect&&this.onTrackSelect(t)}updateActiveTrack(){this.listElement.querySelectorAll(".audio-item").forEach(t=>{t.classList.remove("active")});const t=this.listElement.querySelectorAll(".audio-item"),e=this.audioState.currentTrack-1;t[e]&&t[e].classList.add("active")}updatePlayingState(){this.renderTracks()}markTrackCompleted(t){const n=this.listElement.querySelectorAll(".audio-item"),a=t-1;if(n[a]){n[a].classList.add("completed");const t=n[a].querySelector(".audio-duration");if(t&&!t.querySelector(".completion-badge")){const n=e.createElement("span","completion-badge","✓");t.appendChild(n)}}}scrollToActiveTrack(){const t=this.listElement.querySelector(".audio-item.active");t&&t.scrollIntoView({behavior:"smooth",block:"center"})}update(){this.updateActiveTrack(),this.updatePlayingState()}render(t){t.appendChild(this.element)}}class i{constructor(t,e,n){this.audioState=t,this.audioElement=e,this.callbacks=n,this.element=null,this.create(),this.setupEventListeners()}create(){this.element=e.createElement("div","player-controls"),this.element.innerHTML='\n            <div class="media-player">\n                <div class="main-controls">\n                    <button class="control-btn" id="prevBtn">\n                        <span class="material-icons">skip_previous</span>\n                    </button>\n                    \n                    <button class="control-btn play-pause-btn" id="playPauseBtn">\n                        <span class="material-icons" id="playIcon">play_arrow</span>\n                    </button>\n                    \n                    <button class="control-btn" id="nextBtn">\n                        <span class="material-icons">skip_next</span>\n                    </button>\n                </div>\n            </div>\n        ',this.playPauseBtn=this.element.querySelector("#playPauseBtn"),this.playIcon=this.element.querySelector("#playIcon"),this.prevBtn=this.element.querySelector("#prevBtn"),this.nextBtn=this.element.querySelector("#nextBtn")}setupEventListeners(){this.playPauseBtn.addEventListener("click",()=>{this.callbacks.onPlayPause&&this.callbacks.onPlayPause()}),this.prevBtn.addEventListener("click",()=>{this.callbacks.onPrevious&&this.callbacks.onPrevious()}),this.nextBtn.addEventListener("click",()=>{this.callbacks.onNext&&this.callbacks.onNext()})}updatePlayState(t){this.playIcon.textContent=t?"pause":"play_arrow"}setEnabled(t){this.element.querySelectorAll("button").forEach(e=>{e.disabled=!t}),t?this.element.classList.remove("disabled"):this.element.classList.add("disabled")}update(){const t=!this.audioElement.paused;this.updatePlayState(t);const e=null!==this.audioState.getCurrentTrack();this.setEnabled(e)}render(t){t.appendChild(this.element)}}class r{constructor(){this.audioState=new n,this.audioElement=null,this.header=null,this.audioList=null,this.mediaPlayer=null,this.trackListeningProgress=new Map}async init(){this.createAudioElement(),await this.audioState.initializeTracks(),this.createComponents(),this.setupAudioEventListeners(),this.loadCurrentTrack(),this.preloadTrackDurations(),setTimeout(()=>{this.audioState.playlistManager&&(console.log("Re-applying theme after component initialization..."),this.audioState.playlistManager.applyTheme())},500)}createAudioElement(){this.audioElement=document.createElement("audio"),this.audioElement.preload="metadata",document.body.appendChild(this.audioElement)}createComponents(){const t=document.querySelector(".audio-guide");this.header=new a(this.audioState,t=>{this.seekToPercent(t)}),this.header.render(t),this.audioList=new s(this.audioState,t=>{this.selectTrack(t)}),this.audioList.render(t),this.mediaPlayer=new i(this.audioState,this.audioElement,{onPlayPause:()=>this.togglePlayPause(),onPrevious:()=>this.previousTrack(),onNext:()=>this.nextTrack()}),this.mediaPlayer.render(t)}setupAudioEventListeners(){this.audioElement.addEventListener("loadedmetadata",()=>{const t=this.audioState.getCurrentTrack();this.audioState.setDuration(t.id,this.audioElement.duration),this.updateUI()}),this.audioElement.addEventListener("timeupdate",()=>{this.audioState.setCurrentTime(this.audioElement.currentTime),this.updateListeningProgress(),this.updateUI()}),this.audioElement.addEventListener("ended",()=>{this.onTrackEnded()}),this.audioElement.addEventListener("play",()=>{this.audioState.setPlaying(!0),this.updateUI()}),this.audioElement.addEventListener("pause",()=>{this.audioState.setPlaying(!1),this.updateUI()}),this.audioElement.addEventListener("error",t=>{console.error("Audio error:",t),this.audioState.setPlaying(!1),this.updateUI()})}loadCurrentTrack(){const t=this.audioState.getCurrentTrack();t&&(this.audioElement.src=t.url,this.trackListeningProgress.has(t.id)||this.trackListeningProgress.set(t.id,0),this.updateUI())}selectTrack(t){if(this.audioState.currentTrack!==t){const e=!this.audioElement.paused;this.audioState.setCurrentTrack(t),this.trackListeningProgress.has(t)||this.trackListeningProgress.set(t,0),this.loadCurrentTrack(),e&&setTimeout(()=>{this.audioElement.play().catch(t=>{console.error("Auto-play failed:",t)})},100)}}togglePlayPause(){this.audioElement.paused?this.audioElement.play().catch(t=>{console.error("Play failed:",t)}):this.audioElement.pause()}previousTrack(){const t=this.audioState.currentTrack;t>1&&this.selectTrack(t-1)}nextTrack(){const t=this.audioState.currentTrack;t<this.audioState.tracks.length&&this.selectTrack(t+1)}seekToPercent(t){this.audioElement.duration&&(this.audioElement.currentTime=t/100*this.audioElement.duration)}updateListeningProgress(){if(this.audioElement.duration>0&&this.audioElement.currentTime>0){const t=this.audioState.getCurrentTrack(),e=this.audioElement.currentTime/this.audioElement.duration*100;e>(this.trackListeningProgress.get(t.id)||0)&&this.trackListeningProgress.set(t.id,e)}}onTrackEnded(){const t=this.audioState.getCurrentTrack(),e=this.trackListeningProgress.get(t.id)||0;e>=90?(this.audioState.markTrackCompleted(t.id),console.log(`Track ${t.id} marked as completed (${e.toFixed(1)}% listened)`)):console.log(`Track ${t.id} ended but not marked as completed (only ${e.toFixed(1)}% listened)`),this.audioState.currentTrack<this.audioState.tracks.length&&setTimeout(()=>{const t=this.audioState.currentTrack+1;this.audioState.setCurrentTrack(t),this.loadCurrentTrack(),setTimeout(()=>{this.audioElement.play().catch(t=>{console.error("Auto-play failed:",t)})},100)},1e3),this.updateUI()}preloadTrackDurations(){const t=document.createElement("audio");t.preload="metadata";const e=this.audioState.tracks.filter(t=>0===t.duration);if(0===e.length)return void console.log("All tracks already have duration information");console.log(`Preloading duration for ${e.length} tracks`);let n=0;const a=()=>{if(n>=e.length)return void this.updateUI();const s=e[n];t.src=s.url,t.addEventListener("loadedmetadata",()=>{t.duration&&!isNaN(t.duration)&&(this.audioState.setDuration(s.id,t.duration),console.log(`Loaded duration for track ${s.id}: ${t.duration}s`)),n++,setTimeout(a,100)},{once:!0}),t.addEventListener("error",()=>{console.warn(`Failed to load duration for track ${s.id}`),n++,setTimeout(a,100)},{once:!0}),t.load()};a()}updateUI(){this.header&&(this.header.update(),this.header.updateProgress(this.audioElement.currentTime||0,this.audioElement.duration||0)),this.audioList&&this.audioList.update(),this.mediaPlayer&&this.mediaPlayer.update()}}document.addEventListener("DOMContentLoaded",async()=>{const t=new r;await t.init()})})();